<!DOCTYPE html>
<html>
<head>
    <title>Lockpick to Cookie Bot</title>
</head>
<body>
Lockpick titles.keys: <input type="file" id="lockpick" name="lockpick" /><br>
<div id="resultDiv" style="display:none;">
    <textarea id="result" style="width: 100%;"></textarea>
</div>
<script type="text/javascript">
function handleFileSelect(event) {
    let files = event.target.files; // FileList object
    let reader = new FileReader();

  // Closure to capture the file information and read it.
    reader.onload = (function(theFile) {
        return function(e) {
            if (! theFile.name.toLowerCase().match(/titles?.keys/i)) {
                alert('You must upload a title.keys from Lockpick!');
                return;
            }

            let contents = e.target.result.split(/\n/);
            let result = [];
            let resultsDiv = document.getElementById('resultDiv');
            let resultsText = document.getElementById('result');

            for (let i = 0; i < contents.length; i++) {
                let titleid = contents[i].substr(0, 16);
                if (titleid.substr(13) != 800 && titleid.length > 0 && ! result.includes(titleid)) {
                    result.push(titleid);
                }
            }

            while (result.length > 110) {
                let newText = resultsText.cloneNode();
                newText.id = '';
                resultsDiv.insertBefore(newText, resultsText);
                newText.value = "g!sub " + result.splice(0,110).join(', ');
            }

            resultsDiv.style.display = '';
            resultsText.value = "g!sub " + result.join(', ');
        };
    })(files[0]);
    reader.readAsText(files[0]);
}

document.getElementById('lockpick').addEventListener('change', handleFileSelect, false);
</script>
</body>
</html>